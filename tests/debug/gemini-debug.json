[
  {
    "timestamp": "2025-11-14T17:22:56.182Z",
    "url": "https://6916b7543620c585e7058fa2--7th-grade-pre-algebra.netlify.app/js/features/word-problem-generator.js",
    "status": 200,
    "statusText": "",
    "body": "// Word Problem Generator using Google Gemini AI\n// Generates age-appropriate word problems for 7th graders\n\nclass WordProblemGenerator {\n    constructor() {\n        // Use serverless function instead of direct API access\n        this.apiEndpoint = '/.netlify/functions/gemini-api';\n        this.cache = new Map(); // Cache generated problems\n        this.maxCacheSize = 50;\n        this.useServerlessFunction = true;\n    }\n\n    // Parse equation to extract coefficients\n    parseEquation(equationStr) {\n        // Handle equations like \"5x + 7 = 52\" or \"3x - 4 = 14\"\n        const parts = equationStr.split('=');\n        if (parts.length !== 2) {\n            return { coefficient: 1, constant: 0, result: 0 };\n        }\n\n        const leftSide = parts[0].trim();\n        const result = parseInt(parts[1].trim());\n\n        // Extract coefficient of x\n        const xMatch = leftSide.match(/(-?\\d*)x/);\n        const coefficient = xMatch ? (xMatch[1] === '' || xMatch[1] === '+' ? 1 : xMatch[1] === '-' ? -1 : parseInt(xMatch[1])) : 1;\n\n        // Extract constant term\n        const constantMatch = leftSide.match(/[+-]\\s*(\\d+)(?!x)/);\n        const constant = constantMatch ? parseInt(constantMatch[0].replace(/\\s/g, '')) : 0;\n\n        return { coefficient, constant, result };\n    }\n\n    // Generate a word problem using Gemini AI with exact equation match\n    async generateWordProblem(equation, difficulty) {\n        const equationStr = equation.equation;\n        const equationType = equation.type;\n        const answer = equation.answer;\n\n        // Parse equation to get coefficients\n        const { coefficient, constant, result } = this.parseEquation(equationStr);\n\n        // Check cache first\n        const cacheKey = `${equationStr}-${difficulty}`;\n        if (this.cache.has(cacheKey)) {\n            console.log('ğŸ“¦ Using cached word problem');\n            return this.cache.get(cacheKey);\n        }\n\n        try {\n            const prompt = this.buildPrompt(coefficient, constant, result, answer, equationType, difficulty);\n\n            // Call serverless function instead of Gemini API directly\n            const response = await fetch(this.apiEndpoint, {\n                method: 'POST',\n                headers: {\n                    'Content-Type': 'application/json',\n                },\n                body: JSON.stringify({\n                    prompt: prompt,\n                    studentContext: {\n                        equation: equationStr,\n                        level: difficulty,\n                        concept: 'Two-Step Equations'\n                    }\n                })\n            });\n\n            if (!response.ok) {\n                console.error('Word problem API error:', response.status);\n                return this.getFallbackProblem(coefficient, constant, result, answer, equationType);\n            }\n\n            const data = await response.json();\n            const wordProblem = data.response.trim();\n\n            // Cache the result\n            this.addToCache(cacheKey, wordProblem);\n\n            console.log('âœ¨ Generated word problem with Gemini AI');\n            console.log(`   Equation: ${coefficient}x + ${constant} = ${result} (x = ${answer})`);\n            return wordProblem;\n\n        } catch (error) {\n            console.error('Error generating word problem:', error);\n            return this.getFallbackProblem(coefficient, constant, result, answer, equationType);\n        }\n    }\n\n    // Build the AI prompt with exact equation structure\n    buildPrompt(coefficient, constant, result, answer, equationType, difficulty) {\n        const difficultyContext = {\n            easy: 'simple, straightforward',\n            medium: 'moderately challenging',\n            hard: 'complex and challenging'\n        };\n\n        const typeContext = {\n            'two-step-basic': 'two-step equation',\n            'two-step equation': 'two-step equation',\n            'combining like terms': 'equation with combining like terms',\n            'distributive property': 'equation using distributive property',\n            'variables on both sides': 'equation with variables on both sides',\n            'complex-mixed': 'complex equation combining multiple concepts'\n        };\n\n        // Build equation description based on sign\n        const constantPart = constant >= 0 ? `plus ${constant}` : `minus ${Math.abs(constant)}`;\n        const equationDescription = `${coefficient}x ${constantPart} equals ${result}`;\n\n        return `You are a 7th grade math teacher creating engaging word problems for students learning pre-algebra.\n\nCreate a ${difficultyContext[difficulty] || 'moderately challenging'} word problem that EXACTLY matches this equation:\n${coefficient}x ${constant >= 0 ? '+' : '-'} ${Math.abs(constant)} = ${result}\n\nWhere:\n- ${coefficient} is the rate/coefficient (how much per unit)\n- ${Math.abs(constant)} is the starting amount or adjustment (${constant >= 0 ? 'added' : 'subtracted'})\n- ${result} is the final total\n- The answer is x = ${answer}\n\nThe word problem should:\n1. Be relatable to 7th grade students (ages 12-13)\n2. Use real-world scenarios: money, gaming, sports, phones, food, collecting items, etc.\n3. Have EXACTLY the structure: \"${coefficient} times something ${constant >= 0 ? 'plus' : 'minus'} ${Math.abs(constant)} equals ${result}\"\n4. Be exactly 2-3 sentences long\n5. NOT include the equation itself - students need to figure it out\n6. Make it clear what the variable represents\n\nExample for 3x + 5 = 20:\n\"Marco is collecting trading cards. He has 5 cards already and buys 3 cards each week. After a certain number of weeks, Marco has 20 cards total. How many weeks did he collect?\"\n\nWrite ONLY the word problem text. No equations, no solutions, no extra explanations.`;\n    }\n\n    // Fallback word problems when API is unavailable\n    getFallbackProblem(coefficient, constant, result, answer, equationType) {\n        const scenarios = [\n            {\n                template: `{name} is saving money for a new gaming console. {pronoun_cap} already has $${Math.abs(constant)} and plans to save $${coefficient} each week from {pronoun_pos} allowance. After ${answer} weeks, {pronoun} will have $${result}. How many weeks did it take?`,\n                names: ['Alex', 'Jordan', 'Taylor', 'Morgan', 'Casey'],\n                pronouns: { cap: 'They', pos: 'their', obj: 'they' }\n            },\n            {\n                template: `A student is collecting rare sneakers. Starting with ${Math.abs(constant)} pairs, the student buys ${coefficient} ${coefficient === 1 ? 'pair' : 'pairs'} each month. After ${answer} months, the collection has ${result} pairs total.`,\n                names: [],\n                pronouns: {}\n            },\n            {\n                template: `Your phone has ${Math.abs(constant)} GB used already. You download ${coefficient} GB of games each day. After ${answer} days, you've used ${result} GB total. How many days passed?`,\n                names: [],\n                pronouns: {}\n            },\n            {\n                template: `A basketball player scored ${Math.abs(constant)} points in the first quarter. In each remaining quarter, the player scores ${coefficient} ${coefficient === 1 ? 'point' : 'points'}. After ${answer} more quarters, the total score is ${result} points.`,\n                names: [],\n                pronouns: {}\n            }\n        ];\n\n        const scenario = scenarios[Math.floor(Math.random() * scenarios.length)];\n        let problem = scenario.template;\n\n        // Replace placeholders\n        if (scenario.names.length > 0) {\n            const name = scenario.names[Math.floor(Math.random() * scenario.names.length)];\n            problem = problem.replace(/{name}/g, name);\n            problem = problem.replace(/{pronoun_cap}/g, scenario.pronouns.cap);\n            problem = problem.replace(/{pronoun_pos}/g, scenario.pronouns.pos);\n            problem = problem.replace(/{pronoun}/g, scenario.pronouns.obj);\n        }\n\n        console.log(`ğŸ“ Using fallback problem for ${coefficient}x + ${constant} = ${result}`);\n        return problem;\n    }\n\n    // Cache management\n    addToCache(key, value) {\n        // Implement simple LRU cache\n        if (this.cache.size >= this.maxCacheSize) {\n            const firstKey = this.cache.keys().next().value;\n            this.cache.delete(firstKey);\n        }\n        this.cache.set(key, value);\n    }\n\n    // Clear cache\n    clearCache() {\n        this.cache.clear();\n        console.log('ğŸ—‘ï¸ Word problem cache cleared');\n    }\n\n    // Set API key manually (for testing)\n    setApiKey(key) {\n        this.apiKey = key;\n        localStorage.setItem('GEMINI_API_KEY', key);\n        console.log('âœ… Gemini API key set');\n    }\n}\n\n// Initialize global instance\nwindow.addEventListener('DOMContentLoaded', () => {\n    window.wordProblemGenerator = new WordProblemGenerator();\n    console.log('ğŸ“ Word Problem Generator initialized');\n});\n",
    "request": {
      "url": "https://6916b7543620c585e7058fa2--7th-grade-pre-algebra.netlify.app/js/features/word-problem-generator.js",
      "method": "GET",
      "postData": null
    }
  }
]